<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>èŠ±è“®è»ŠéšŠ - æ•¸æ“šæ¬å®¶å·¥å…·</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #222; color: #0f0; padding: 20px; }
        h1 { color: #fff; border-bottom: 1px solid #555; padding-bottom: 10px; }
        textarea { width: 100%; height: 200px; background: #111; color: #fff; border: 1px solid #444; padding: 10px; font-size: 14px; }
        button { background: #00bcd4; color: #000; font-size: 20px; font-weight: bold; padding: 15px 30px; border: none; cursor: pointer; margin-top: 10px; border-radius: 5px; }
        button:hover { background: #00acc1; }
        #log { margin-top: 20px; white-space: pre-wrap; color: #aaa; }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

    <h1>ğŸš€ CSV to Firebase æ¬å®¶å·¥å…·</h1>
    <p>è«‹å°‡ CSV å…§å®¹è²¼åœ¨ä¸‹æ–¹ (æ ¼å¼ï¼šID, å§“å, è»Šè™Ÿ, é›»è©±)</p>
    <p style="color:yellow">æ³¨æ„ï¼šç¬¬ä¸€è¡Œå¦‚æœæ˜¯æ¨™é¡Œ (å¦‚ id,name...) è«‹ä¸è¦è¤‡è£½ï¼Œåªè¤‡è£½è³‡æ–™éƒ¨åˆ†ã€‚</p>
    
    <textarea id="csvInput" placeholder="U12345..., ç‹å¤§æ˜, TD-1234, 0912345678&#10;U67890..., æå°è¯, TD-5678, 0988777666"></textarea>
    
    <button onclick="startMigration()">ğŸš€ é–‹å§‹å¯«å…¥è³‡æ–™åº«</button>
    
    <div id="log">æº–å‚™å°±ç·’...</div>

<script>
    // 1. åˆå§‹åŒ– Firebase
    const firebaseConfig = {
        databaseURL: "https://hualientaxi-bb32f-default-rtdb.asia-southeast1.firebasedatabase.app/",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function log(msg, type = '') {
        const el = document.getElementById('log');
        const span = document.createElement('div');
        span.className = type;
        span.innerText = msg;
        el.prepend(span); // æ–°è¨Šæ¯åœ¨æœ€ä¸Šé¢
    }

    function startMigration() {
        const input = document.getElementById('csvInput').value.trim();
        if (!input) { alert("è«‹å…ˆè²¼ä¸Š CSV è³‡æ–™ï¼"); return; }

        const rows = input.split('\n');
        log(`åµæ¸¬åˆ° ${rows.length} ç­†è³‡æ–™ï¼Œé–‹å§‹è™•ç†...`);

        rows.forEach((row, index) => {
            // ç°¡å–®çš„ CSV è§£æ (å‡è¨­æ²’æœ‰é€—è™Ÿåœ¨å…§å®¹ä¸­)
            const cols = row.split(',').map(c => c.trim());
            
            // æ¬„ä½å°æ‡‰ï¼š0:ID, 1:Name, 2:Car, 3:Phone
            if (cols.length < 4) {
                log(`[è·³é] ç¬¬ ${index+1} è¡Œæ ¼å¼éŒ¯èª¤: ${row}`, 'error');
                return;
            }

            const id = cols[0];
            const data = {
                name: cols[1],
                car: cols[2],
                phone: cols[3],
                role: "driver", // æ¨™è¨˜ç‚ºå¸æ©Ÿ
                staticDataSynced: true,
                lastUpdate: Date.now() // çµ¦ä¸€å€‹åˆå§‹æ™‚é–“
            };

            // ä½¿ç”¨ update é¿å…è¦†è“‹ç¾æœ‰çš„ GPS (å¦‚æœæœ‰çš„è©±)
            db.ref('drivers/' + id).update(data)
                .then(() => log(`[æˆåŠŸ] ${data.name} (${data.car}) å·²å¯«å…¥`, 'success'))
                .catch(err => log(`[å¤±æ•—] ${id}: ${err.message}`, 'error'));
        });
    }
</script>
</body>
</html>
