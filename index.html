// v8.3 è·¨å¹³å°æ”¾è¡Œç‰ˆ - å¸æ©Ÿç«¯å‰ç«¯
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>èŠ±è“®è»ŠéšŠ - å¸æ©Ÿç«¯</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIxc6PEhHgUs_A9lyRUg8dNbmwOpSamY8&libraries=geometry"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body { margin: 0; padding: 0; font-family: -apple-system, Roboto, sans-serif; overflow: hidden; background: #121212; color: white; }
    #map { width: 100vw; height: 100vh; display: none; } 
    
    @keyframes flash-alert { 0% { background-color: #121212; } 50% { background-color: #b71c1c; } 100% { background-color: #121212; } }
    .flashing { animation: flash-alert 0.5s infinite; }

    #unlock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 20000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
    .btn-unlock { width: 120px; height: 120px; border-radius: 50%; background: radial-gradient(circle, #00C853 0%, #009624 100%); border: 4px solid #fff; box-shadow: 0 0 30px rgba(0,200,83,0.6); color: white; font-size: 24px; font-weight: bold; cursor: pointer; animation: pulse-green 2s infinite; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .btn-unlock:active { transform: scale(0.95); }
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(0, 200, 83, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(0, 200, 83, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 200, 83, 0); } }

    #ui-layer { display: none; pointer-events: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 10; }
    
    #hud { pointer-events: auto; position: absolute; top: 15px; left: 15px; background: rgba(33, 33, 33, 0.9); color: white; padding: 10px 20px; border-radius: 30px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); display: flex; align-items: center; }
    .status-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    .hud-uploading { border-color: #00C853 !important; box-shadow: 0 0 15px rgba(0, 200, 83, 0.5); }
    
    #top-right-panel { pointer-events: auto; position: absolute; top: 15px; right: 15px; display: flex; flex-direction: column; gap: 12px; }
    .circle-btn { width: 60px; height: 60px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.8); color: white; font-weight: bold; font-size: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(4px); position: relative; }
    .bg-off { background: linear-gradient(145deg, #7f8c8d, #95a5a6); }
    .bg-on { background: linear-gradient(145deg, #d32f2f, #ef5350); }
    .bg-empty { background: linear-gradient(145deg, #2e7d32, #43a047); }
    .bg-queue { background: linear-gradient(145deg, #1565c0, #1976d2); }
    .bg-busy { background: linear-gradient(145deg, #ef6c00, #fb8c00); }
    .bg-dark { background: linear-gradient(145deg, #37474f, #455a64); }
    .sub-text { font-size: 10px; opacity: 0.9; margin-top: 0px; font-weight: normal; }

    #mission-panel { 
        pointer-events: auto; display: none; 
        position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); 
        width: 90%; max-width: 350px; 
        background: #222; border: 2px solid #FFD700; border-radius: 15px; 
        padding: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); 
        text-align: center; color: white; animation: slideUp 0.3s;
    }
    @keyframes slideUp { from { transform: translate(-50%, 100px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
    .mission-title { color: #FFD700; font-size: 20px; font-weight: bold; margin-bottom: 5px; }
    .mission-info { font-size: 16px; margin-bottom: 15px; color: #ddd; }
    .btn-finish { background: #00C853; color: white; border: none; padding: 12px 20px; border-radius: 25px; font-weight: bold; font-size: 18px; cursor: pointer; width: 100%; box-shadow: 0 4px 10px rgba(0,200,83,0.3); }

    #register-box { width: 90%; max-width: 400px; background: #222; padding: 25px; border-radius: 15px; border: 1px solid #444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 30000; }
    .form-input { width: 100%; padding: 12px; background: #333; border: 1px solid #555; border-radius: 8px; color: white; font-size: 16px; box-sizing: border-box; }
    .btn-post { width: 100%; background: #D50000; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 18px; cursor: pointer; }
    
    #saver-overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 9999; flex-direction: column; justify-content: center; align-items: center; color: #555; user-select: none; }
    #saver-overlay.active { display: flex; }
    #saver-overlay.pressing p { color: #00C853; transition: color 0.3s; }

    .swal2-container { z-index: 99999 !important; }
  </style>
</head>
<body>

  <div id="unlock-screen">
      <button class="btn-unlock" onclick="systemStart()">
          <i class="fa-solid fa-power-off"></i> START
      </button>
      <div id="loading-text" style="margin-top:20px;color:#aaa;">é»æ“Šå•Ÿå‹•ç³»çµ±</div>
  </div>

  <div id="map"></div>

  <div id="ui-layer">
      <div id="hud"><span class="status-dot" style="background:gray;"></span> ç³»çµ±å¾…å‘½</div>
      
      <div id="top-right-panel">
        <button id="btn-power" class="circle-btn bg-off" onclick="togglePower()"><i class="fa-solid fa-power-off"></i><span class="sub-text">OFF</span></button>
        <button id="btn-status" class="circle-btn bg-empty" style="display:none;" onclick="toggleStatus()"><span id="txt-status">ç©ºè»Š</span></button>
        <button id="btn-saver" class="circle-btn bg-dark" style="display:none;" onclick="toggleSaver(true)"><i class="fa-solid fa-moon"></i><span class="sub-text">æ›æ©Ÿ</span></button>
      </div>

      <div id="mission-panel">
          <div class="mission-title"><i class="fa-solid fa-phone-volume"></i> ä¹˜å®¢å‘¼å«ä¸­!</div>
          <div class="mission-info" id="mission-dist">æ­£åœ¨è¨ˆç®—è·é›¢...</div>
          <button class="btn-finish" onclick="finishMission()">ğŸ æˆ‘æ¥åˆ°äº† (æ¸…é™¤)</button>
      </div>
  </div>

  <audio id="sound-boot" src="data:audio/mpeg;base64,//uQxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uQxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"></audio>
  <audio id="sound-alert" src="data:audio/wav;base64,UklGRl9vT1BXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"></audio>

  <div id="register-box">
      <div style="font-size:24px;font-weight:bold;margin-bottom:20px;text-align:center;color:#FFD700;">ğŸ“‹ å¸æ©Ÿå…¥éšŠç”³è«‹</div>
      <input type="text" id="reg-name" class="form-input" style="margin-bottom:10px;" placeholder="çœŸå¯¦å§“å">
      <input type="text" id="reg-car" class="form-input" style="margin-bottom:10px;" placeholder="è»Šç‰Œ (TDP-123)">
      <input type="tel" id="reg-phone" class="form-input" style="margin-bottom:10px;" placeholder="é›»è©±">
      <input type="text" id="reg-uid" class="form-input" style="margin-bottom:10px;" readonly>
      <button class="btn-post" style="background:#00C853;" onclick="submitRegistration()">é€å‡ºå¯©æ ¸</button>
  </div>

  <div id="saver-overlay"><p style="font-size:14px; letter-spacing: 1px;">GPS æŒçºŒé€£ç·š â€¢ é•·æŒ‰å–šé†’</p></div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const LIFF_ID = "2008907691-7ntMtfbA"; 
    const firebaseConfig = { databaseURL: "https://hualientaxi-bb32f-default-rtdb.asia-southeast1.firebasedatabase.app/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    var map, myMarker, currentUser = null, isOnline = false;
    var currentWorkStatus = 'empty'; 
    var watchId = null, wakeLock = null, heartbeatInterval = null;
    var lastUploadTime = 0, lastUploadLat = 0, lastUploadLng = 0;
    var queueCenter = null; 
    var passengerMarker = null, routeLine = null;
    
    // v6.1: æ–·ç·šæª¢æŸ¥å™¨
    var checkConnectionInterval = null; 
    var pressTimer = null;

    const UPDATE_INTERVAL = 15000; 
    const HEARTBEAT_TIME = 180000; 
    const MIN_UPLOAD_DIST = 100; 
    const STATIONARY_THRESHOLD = 20;
    const CONNECTION_TIMEOUT = 600000; 
    const RENDER_MIN_DIST = 5; 
    var lastRenderLat = 0, lastRenderLng = 0, lastRenderTime = 0;

    const getArrowIcon = (color, heading) => {
        return { path: "M0,-12 L10,10 L0,5 L-10,10 Z", fillColor: color, fillOpacity: 1, scale: 1.5, strokeColor: "#333", strokeWeight: 1, rotation: heading || 0 };
    };

    window.onload = function() {
        document.getElementById('loading-text').innerText = "ç³»çµ±è¼‰å…¥ä¸­...";
        initLiff(); initGoogleMap();
        document.getElementById('loading-text').innerText = "æº–å‚™å°±ç·’ï¼Œè«‹é»æ“Šå•Ÿå‹•";
    };

    function systemStart() {
        const boot = document.getElementById('sound-boot');
        if(boot) boot.play().catch(e=>{});
        
        document.getElementById('unlock-screen').style.display = 'none';
        document.getElementById('map').style.display = 'block';
        document.getElementById('ui-layer').style.display = 'block';
        if (currentUser) checkIdentity(currentUser.userId);
        setupSaverEvents();
    }

    function initGoogleMap() {
        map = new google.maps.Map(document.getElementById("map"), { center: { lat: 23.991, lng: 121.601 }, zoom: 15, disableDefaultUI: true });
    }

    async function initLiff() {
        try { 
            await liff.init({ liffId: LIFF_ID });
            
            // v8.3 è·¨å¹³å°è§£é–ï¼šé LINE ç’°å¢ƒæ”¹ç‚ºè‡ªå‹•å–šèµ·ç™»å…¥
            if (!liff.isLoggedIn()) {
                // å¦‚æœæ²’æœ‰ç™»å…¥ï¼Œå°±è·³è½‰åˆ° LINE çš„ç™»å…¥ç•«é¢
                liff.login();
                return;
            } else {
                // å·²ç¶“ç™»å…¥ï¼Œå°±æŠ“å–è³‡æ–™
                currentUser = await liff.getProfile(); 
                localStorage.setItem('driverId', currentUser.userId);
            }
        } catch (e) {
            console.error("LIFF åˆå§‹åŒ–å¤±æ•—", e);
        }
    }

    function checkIdentity(uid) {
        db.ref('drivers/' + uid).once('value').then(snapshot => {
            if (snapshot.exists()) {
                const d = snapshot.val();
                document.getElementById('hud').innerHTML = `<span class="status-dot" style="background:#2ecc71;"></span> å—¨ï¼Œ${d.name}`;
                document.getElementById('btn-power').style.display = 'flex';
                if(localStorage.getItem('isOnline') === 'true') togglePower(true);
                listenForRequests(uid);
            } else {
                document.getElementById('ui-layer').style.display = 'none';
                document.getElementById('register-box').style.display = 'block';
                document.getElementById('reg-uid').value = uid;
            }
        });
    }

    // --- æ ¸å¿ƒï¼šç›£è½ä¹˜å®¢å‘¼å« (v6.1 çˆ†é–ƒ) ---
    function listenForRequests(uid) {
        db.ref('drivers/' + uid + '/request').on('value', snapshot => {
            const req = snapshot.val();
            if (req) {
                const alert = document.getElementById('sound-alert');
                if(alert) { alert.currentTime = 0; alert.play().catch(e=>{}); }
                if(navigator.vibrate) navigator.vibrate([500, 200, 500, 200, 500]);
                
                // çˆ†é–ƒå‹•ç•«
                document.body.classList.add('flashing');
                setTimeout(() => { document.body.classList.remove('flashing'); }, 5000);

                const pLoc = new google.maps.LatLng(req.lat, req.lng);
                if(!passengerMarker) {
                    passengerMarker = new google.maps.Marker({
                        position: pLoc, map: map, label: { text: "å®¢", color: "white" },
                        icon: { path: google.maps.SymbolPath.CIRCLE, scale: 10, fillColor: "#D50000", fillOpacity: 1, strokeColor: "white", strokeWeight: 2 },
                        animation: google.maps.Animation.BOUNCE
                    });
                } else { passengerMarker.setPosition(pLoc); }

                if(myMarker) {
                    if(routeLine) routeLine.setMap(null);
                    routeLine = new google.maps.Polyline({
                        path: [myMarker.getPosition(), pLoc], geodesic: true,
                        strokeColor: '#2962FF', strokeOpacity: 0.8, strokeWeight: 5,
                        icons: [{ icon: {path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW}, offset: '100%' }],
                        map: map
                    });
                    const dist = google.maps.geometry.spherical.computeDistanceBetween(myMarker.getPosition(), pLoc);
                    document.getElementById('mission-dist').innerText = `ä¹˜å®¢è·é›¢ï¼š${Math.round(dist)} å…¬å°º`;
                }
                document.getElementById('mission-panel').style.display = 'block';
            } else {
                finishMission(false);
            }
        });
    }

    function finishMission(updateDB = true) {
        if(passengerMarker) { passengerMarker.setMap(null); passengerMarker = null; }
        if(routeLine) { routeLine.setMap(null); routeLine = null; }
        document.getElementById('mission-panel').style.display = 'none';
        if(updateDB && currentUser) db.ref('drivers/' + currentUser.userId + '/request').remove();
    }

    // --- GPS èˆ‡ ä¸Šå‚³ ---
    function startGPS() {
        if (!navigator.geolocation) return;
        watchId = navigator.geolocation.watchPosition((pos) => {
            const { latitude, longitude, heading } = pos.coords;
            smartUpload(latitude, longitude, heading);
        }, (err) => console.error(err), { enableHighAccuracy: true, maximumAge: 0 });
    }

    function smartUpload(lat, lng, heading) {
        if(!currentUser || !isOnline) return;
        const now = Date.now();
        const distRender = Math.sqrt(Math.pow(lat - lastRenderLat, 2) + Math.pow(lng - lastRenderLng, 2)) * 111000;
        if (distRender > RENDER_MIN_DIST || now - lastRenderTime > 2000) {
            updateMarker(lat, lng, heading);
            lastRenderLat = lat; lastRenderLng = lng; lastRenderTime = now;
        }
        if (currentWorkStatus === 'queue' && queueCenter) {
            const distFromQueue = Math.sqrt(Math.pow(lat - queueCenter.lat, 2) + Math.pow(lng - queueCenter.lng, 2)) * 111000;
            if (distFromQueue > 500) {
                currentWorkStatus = 'empty'; queueCenter = null; updateStatusBtn(); updateHUD(false, "âš ï¸ å·²é›¢é–‹æ’ç­å€ï¼Œåˆ‡æ›ç‚ºç©ºè»Š"); forceUpload(lat, lng); return;
            }
        }
        const distUploadMeters = Math.sqrt(Math.pow(lat - lastUploadLat, 2) + Math.pow(lng - lastUploadLng, 2)) * 111000;
        const timeDiff = now - lastUploadTime;
        if (distUploadMeters > MIN_UPLOAD_DIST) { forceUpload(lat, lng); return; }
        if (timeDiff > UPDATE_INTERVAL && distUploadMeters > STATIONARY_THRESHOLD) { forceUpload(lat, lng); return; }
        if (timeDiff > HEARTBEAT_TIME) { forceUpload(lat, lng); return; }
    }

    function updateMarker(lat, lng, heading) {
        const latLng = new google.maps.LatLng(lat, lng);
        const color = currentWorkStatus==='busy'?'#e67e22':(currentWorkStatus==='queue'?'#3498db':'#2ecc71');
        if (!myMarker) { myMarker = new google.maps.Marker({ position: latLng, map: map, icon: getArrowIcon(color, heading), title: "æˆ‘" }); map.panTo(latLng); } 
        else { 
            myMarker.setPosition(latLng); myMarker.setIcon(getArrowIcon(color, heading)); 
            if(!document.getElementById('saver-overlay').classList.contains('active')) map.panTo(latLng);
        }
        if(passengerMarker && routeLine) { 
            routeLine.setPath([latLng, passengerMarker.getPosition()]); 
            const dist = google.maps.geometry.spherical.computeDistanceBetween(latLng, passengerMarker.getPosition()); 
            document.getElementById('mission-dist').innerText = `ä¹˜å®¢è·é›¢ï¼š${Math.round(dist)} å…¬å°º`; 
        }
    }

    function forceUpload(lat, lng) {
        if(!currentUser) return;
        if(!lat && myMarker) { const pos = myMarker.getPosition(); lat = pos.lat(); lng = pos.lng(); }
        if(!lat) return;
        updateHUD(true, "âš¡ è³‡æ–™ä¸Šå‚³...");
        db.ref('drivers/'+currentUser.userId).update({
            lat: lat, lng: lng, status: 'online', workStatus: currentWorkStatus,
            lastUpdate: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            setTimeout(() => { updateHUD(false, `ğŸŸ¢ ä¸Šç·šä¸­ (${getWorkStatusText()})`); }, 1000);
            lastUploadTime = Date.now(); 
        }).catch(e => { console.error("Upload failed", e); });
        lastUploadLat = lat; lastUploadLng = lng; 
    }

    function updateHUD(isUploading, text) {
        const hud = document.getElementById('hud');
        hud.innerHTML = `<span class="status-dot" style="background:${isUploading ? '#00C853' : '#2ecc71'};"></span> ${text}`;
        if(isUploading) hud.classList.add('hud-uploading'); else hud.classList.remove('hud-uploading');
    }

    // --- v6.1: æ–·ç·šæª¢æŸ¥ ---
    function startConnectionCheck() {
        if(checkConnectionInterval) clearInterval(checkConnectionInterval);
        checkConnectionInterval = setInterval(() => {
            if(!isOnline) return;
            const now = Date.now();
            if (now - lastUploadTime > CONNECTION_TIMEOUT) {
                Swal.fire({
                    icon: 'error', title: 'âš ï¸ é€£ç·šé€¾æ™‚',
                    text: 'ç³»çµ±å·²è¶…é 10 åˆ†é˜ç„¡æ³•ä¸Šå‚³è³‡æ–™ã€‚\nè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šï¼',
                    confirmButtonText: 'æˆ‘çŸ¥é“äº†'
                });
                togglePower(false); 
            }
        }, 60000); 
    }

    function togglePower(forceOn=false) {
        const btn = document.getElementById('btn-power');
        const subBtns = ['btn-status', 'btn-saver'];
        if (forceOn || !isOnline) {
            isOnline = true; localStorage.setItem('isOnline', 'true');
            btn.className = "circle-btn bg-on"; btn.innerHTML = `<i class="fa-solid fa-power-off"></i><span class="sub-text">ON</span>`;
            subBtns.forEach(id => document.getElementById(id).style.display = 'flex');
            requestWakeLock(); startGPS(); startConnectionCheck();
            lastUploadTime = Date.now(); 
            if (heartbeatInterval) clearInterval(heartbeatInterval); 
            heartbeatInterval = setInterval(() => { if(Date.now() - lastUploadTime > HEARTBEAT_TIME) forceUpload(); }, 60000);
        } else {
            isOnline = false; localStorage.setItem('isOnline', 'false');
            btn.className = "circle-btn bg-off"; btn.innerHTML = `<i class="fa-solid fa-power-off"></i><span class="sub-text">OFF</span>`;
            document.getElementById('hud').innerHTML = `<span class="status-dot" style="background:gray;"></span> ç³»çµ±å¾…å‘½`;
            subBtns.forEach(id => document.getElementById(id).style.display = 'none');
            if (watchId) navigator.geolocation.clearWatch(watchId);
            if (checkConnectionInterval) clearInterval(checkConnectionInterval);
            db.ref('drivers/' + currentUser.userId).update({ status: 'offline' });
        }
    }

    function toggleStatus(){ const btn = document.getElementById('btn-status'); const txt = document.getElementById('txt-status'); if(currentWorkStatus === 'empty') { currentWorkStatus = 'queue'; btn.className = "circle-btn bg-queue"; txt.innerText = "æ’ç­"; if(myMarker) { const pos = myMarker.getPosition(); queueCenter = { lat: pos.lat(), lng: pos.lng() }; } } else if (currentWorkStatus === 'queue') { currentWorkStatus = 'busy'; btn.className = "circle-btn bg-busy"; txt.innerText = "è¼‰å®¢"; queueCenter = null; } else { currentWorkStatus = 'empty'; btn.className = "circle-btn bg-empty"; txt.innerText = "ç©ºè»Š"; queueCenter = null; } forceUpload(); }
    function getWorkStatusText() { return currentWorkStatus==='queue'?'æ’ç­':(currentWorkStatus==='busy'?'è¼‰å®¢':'ç©ºè»Š'); }
    function setupSaverEvents() { const overlay = document.getElementById('saver-overlay'); const startPress = (e) => { e.preventDefault(); overlay.classList.add('pressing'); pressTimer = setTimeout(() => { toggleSaver(false); if(navigator.vibrate) navigator.vibrate(100); }, 1500); }; const cancelPress = () => { overlay.classList.remove('pressing'); clearTimeout(pressTimer); }; overlay.addEventListener('touchstart', startPress); overlay.addEventListener('touchend', cancelPress); overlay.addEventListener('mousedown', startPress); overlay.addEventListener('mouseup', cancelPress); }
    function toggleSaver(enable){ const overlay=document.getElementById('saver-overlay'); const btn=document.getElementById('btn-saver'); if(enable){ overlay.classList.add('active'); btn.className="circle-btn bg-empty"; } else{ overlay.classList.remove('active'); overlay.classList.remove('pressing'); btn.className="circle-btn bg-dark"; } }
    async function requestWakeLock() { try { if('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch(e){} }
    function releaseWakeLock() { if(wakeLock) wakeLock.release(); }
    function submitRegistration() { const name = document.getElementById('reg-name').value; const car = document.getElementById('reg-car').value; const phone = document.getElementById('reg-phone').value; const uid = document.getElementById('reg-uid').value; if(!name || !car || !phone) return alert("è«‹å¡«å¯«å®Œæ•´"); liff.sendMessages([{type:'text', text:`ã€ç”³è«‹å…¥éšŠã€‘\nå§“å:${name}\nè»Šè™Ÿ:${car}\né›»è©±:${phone}\nID:${uid}`}]) .then(() => { alert("å·²é€å‡ºç”³è«‹"); document.querySelector('.btn-submit').disabled=true; }).catch(() => alert("è«‹æ‰‹å‹•è¤‡è£½IDçµ¦ç®¡ç†å“¡: " + uid)); }
  </script>
</body>
</html>
