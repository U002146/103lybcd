<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ±è“®è»ŠéšŠ - äººäº‹ç®¡ç†å¾Œå°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; padding: 20px; max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 15px; background: #2ecc71; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        button:hover { background: #27ae60; }
        .del-btn { background: #e74c3c; margin-top: 5px; padding: 8px; font-size: 14px; }
        #driver-list { list-style: none; padding: 0; }
        .driver-item { background: #fff; border-bottom: 1px solid #eee; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .driver-info span { display: block; font-size: 14px; color: #666; }
        .driver-info b { font-size: 18px; color: #333; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ‘®â€â™‚ï¸ æ–°å¢/ä¿®æ”¹å¸æ©Ÿ</h2>
        <div class="form-group">
            <label>LINE ID (å¾å¸æ©Ÿç«¯è¤‡è£½)</label>
            <input type="text" id="uid" placeholder="Uxxxxxxxx...">
        </div>
        <div class="form-group">
            <label>å§“å (æš±ç¨±)</label>
            <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šéŠ˜å“¥">
        </div>
        <div class="form-group">
            <label>è»Šè™Ÿ</label>
            <input type="text" id="car" placeholder="ä¾‹å¦‚ï¼šTDP-1234">
        </div>
        <div class="form-group">
            <label>é›»è©±</label>
            <input type="tel" id="phone" placeholder="09xx-xxx-xxx">
        </div>
        <button onclick="saveDriver()">ğŸ’¾ å„²å­˜è³‡æ–™</button>
    </div>

    <div class="card">
        <h2>ğŸ“‹ ç¾æœ‰å¸æ©Ÿåå–® (<span id="count">0</span>)</h2>
        <div id="driver-list">è¼‰å…¥ä¸­...</div>
    </div>

<script>
    // Config
    const firebaseConfig = { databaseURL: "https://hualientaxi-bb32f-default-rtdb.asia-southeast1.firebasedatabase.app/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // è®€å–åˆ—è¡¨
    db.ref('drivers').on('value', snapshot => {
        const list = document.getElementById('driver-list');
        list.innerHTML = '';
        let count = 0;
        const data = snapshot.val();
        
        if(data) {
            Object.keys(data).forEach(key => {
                const d = data[key];
                if(d.role === 'driver') {
                    count++;
                    const item = document.createElement('div');
                    item.className = 'driver-item';
                    item.innerHTML = `
                        <div class="driver-info">
                            <b>${d.name}</b>
                            <span>${d.car} | ${d.phone}</span>
                            <span style="font-size:10px;color:#aaa;">${key}</span>
                        </div>
                        <button class="del-btn" style="width:auto;" onclick="deleteDriver('${key}', '${d.name}')">åˆªé™¤</button>
                    `;
                    // é»æ“Šé …ç›®å¯å¸¶å…¥ç·¨è¼¯
                    item.onclick = (e) => { 
                        if(e.target.tagName !== 'BUTTON') fillForm(key, d); 
                    };
                    list.appendChild(item);
                }
            });
        }
        document.getElementById('count').innerText = count;
    });

    function saveDriver() {
        const uid = document.getElementById('uid').value.trim();
        const name = document.getElementById('name').value.trim();
        const car = document.getElementById('car').value.trim();
        const phone = document.getElementById('phone').value.trim();

        if(!uid || !name || !car || !phone) { alert("æ‰€æœ‰æ¬„ä½éƒ½è¦å¡«å–”ï¼"); return; }

        db.ref('drivers/' + uid).update({
            name: name,
            car: car,
            phone: phone,
            role: 'driver',
            staticDataSynced: true,
            lastUpdate: Date.now() // çµ¦ä¸€å€‹åˆå§‹æ™‚é–“
        }).then(() => {
            alert("âœ… å„²å­˜æˆåŠŸï¼");
            clearForm();
        }).catch(err => alert("éŒ¯èª¤ï¼š" + err.message));
    }

    function deleteDriver(uid, name) {
        if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${name}ã€çš„æ¬Šé™å—ï¼Ÿ\nä»–å°‡ç„¡æ³•å†ç™»å…¥å¸æ©Ÿç«¯ã€‚`)) {
            db.ref('drivers/' + uid).remove();
        }
    }

    function fillForm(uid, d) {
        document.getElementById('uid').value = uid;
        document.getElementById('name').value = d.name;
        document.getElementById('car').value = d.car;
        document.getElementById('phone').value = d.phone;
        window.scrollTo(0,0);
    }

    function clearForm() {
        document.getElementById('uid').value = '';
        document.getElementById('name').value = '';
        document.getElementById('car').value = '';
        document.getElementById('phone').value = '';
    }
</script>
</body>
</html>
